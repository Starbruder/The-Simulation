<Window x:Class="TheSimulation.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:local="clr-namespace:TheSimulation"
        mc:Ignorable="d"
        Title="Forest fire simulation configuration"
        Height="700"
        Width="1000"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen" KeyDown="Window_KeyDown">

	<Window.Resources>
		<!-- Style für GroupBoxen -->
		<Style x:Key="CustomGroupBoxStyle" TargetType="GroupBox">
			<Setter Property="BorderBrush" Value="#FF4C8F94"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="Padding" Value="10"/>
			<Setter Property="Background" Value="WhiteSmoke"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect Color="Black" Direction="315" ShadowDepth="5" Opacity="0.2" BlurRadius="8"/>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Style für Buttons -->
		<Style x:Key="CustomButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="#FF4C8F94"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="Width" Value="120"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect Color="Black" Direction="315" ShadowDepth="5" Opacity="0.3" BlurRadius="8"/>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Tooltips als Resources im Window -->
		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="PrefillTooltip">
			<Bold>Prefill Forest:</Bold> Populates forest at simulation start.
			<LineBreak/><LineBreak/>
			<Bold>Density Slider:</Bold> Sets percentage of map cells to initially fill with trees (0–100%).
			<LineBreak/>- Random selection uses uniform distribution across all growable cells.
			<LineBreak/>- Elevation-based adjustment reduces probability on higher terrain (same as growth).
			<LineBreak/><LineBreak/>
			<Bold>Effect:</Bold> Quick initial forest setup, creates more realistic landscapes.
		</TextBlock>

		<!-- Terrain -->
		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="TerrainGenerationTooltip">
<Bold>Terrain Generation:</Bold> Generates the terrain using a height map with a central hill and slight random noise. Elevation ranges from 0 (lowest) to 1 (highest).
<LineBreak/><LineBreak/>

<Bold>Tree Placement:</Bold>
Trees are placed on randomly selected cells using a <Bold>uniform distribution</Bold> across all growable cells.
<LineBreak/>
- Each selected cell has a growth probability reduced linearly by elevation:
<LineBreak/>
  P(grow) = 1 - (Elevation × 0.7)
<LineBreak/>
- Small random noise ±0.1 is added to elevation (uniform), changing growth chance by ±7%.
<LineBreak/>
- Example probabilities:
<LineBreak/>
  • Elevation 0.0 → 100%
<LineBreak/>
  • Elevation 0.3 → 79%
<LineBreak/>
  • Elevation 0.5 → 65%
<LineBreak/>
  • Elevation 0.7 → 51%
<LineBreak/>
  • Elevation 1.0 → 30%
<LineBreak/><LineBreak/>

<Bold>Fire Spread on Slopes:</Bold>
Fire spreads faster uphill and slower downhill. Effect is calculated from height difference (Δheight):
<LineBreak/>
• Uphill (Δheight &gt; 0): factor = 1 + Δheight × 2
<LineBreak/>
• Downhill (Δheight &lt; 0): factor = 1 + Δheight
<LineBreak/><LineBreak/>

<Bold>Example:</Bold>
• From 0.3 → 0.5 (Δheight = 0.2): factor = 1.4 → fire spreads 40% faster
<LineBreak/>
• From 0.5 → 0.3 (Δheight = -0.2): factor = 0.8 → fire spreads 20% slower
<LineBreak/><LineBreak/>

<Bold>Effect:</Bold> Enabling terrain generation creates a natural hill-shaped forest with variable tree density, adding realistic randomness and dynamic fire behavior.
		</TextBlock>

		<!-- Trees -->
		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="GrowForestTooltip">
When enabled, trees will grow over time to replenish the forest.
<LineBreak/>
<LineBreak/>
<Bold>Next tree timing:</Bold> Trees grow in steps determined by the simulation clock. 
Each tick triggers an attempt to grow a single tree.
<LineBreak/>
<LineBreak/>
<Bold>Next tree location:</Bold> A cell is chosen randomly from all currently growable cells (those without trees or obstacles). 
If terrain generation is enabled, the growth probability is reduced on higher elevations: 
taller hills are less likely to receive a new tree, while valleys are more likely.
<LineBreak/>
<LineBreak/>
<Bold>Distribution pattern:</Bold> 
- Horizontally: uniform random selection across all free cells. 
- Vertically (height): linear decreasing probability from valleys (high chance) to hills (low chance). 
- Result: more trees appear in low areas, fewer on elevated terrain, creating a natural, uneven forest density.
		</TextBlock>

		<!-- Fire -->
		<TextBlock TextWrapping="Wrap" MaxWidth="320" x:Key="PauseFireTooltip">
<Bold>Pause Growing During Fire:</Bold>
Temporarily disables tree growth while any fire is active.
<LineBreak/><LineBreak/>

<Bold>Effect:</Bold>
<LineBreak/>
• As long as at least one tree is burning, no new trees will grow
<LineBreak/>
• Tree growth resumes automatically once all fires are extinguished
<LineBreak/><LineBreak/>

<Bold>Dependency:</Bold>
This option depends on <Bold>Grow forest</Bold>.
<LineBreak/>
• If <Bold>Grow forest</Bold> is disabled, growth is fully disabled and this option is locked ON
<LineBreak/>
• If <Bold>Grow forest</Bold> is enabled, you can freely toggle this setting
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="360" x:Key="FireSpreadChanceTooltip">
<Bold>Additional Fire Spread Chance (Spot Fires):</Bold>
Controls the probability of long-range ignitions caused by embers or sparks.
<LineBreak/><LineBreak/>

<Bold>Trigger condition:</Bold>
For each burning tree and fire tick:
<LineBreak/>
A random value ∈ [0,1] is compared against the calculated spot fire chance.
<LineBreak/><LineBreak/>

<Bold>Spot fire radius:</Bold>
<LineBreak/>
• Minimum distance: 2 cells
<LineBreak/>
• Maximum distance: 4 cells
<LineBreak/><LineBreak/>

<Bold>Chance calculation:</Bold>
<LineBreak/>
chance =
distanceFactor × windEffect × humidityEffect × temperatureEffect
<LineBreak/><LineBreak/>

<Bold>Distance factor:</Bold>
distanceFactor = 2 / distance
<LineBreak/>
• Distance 2 → 1.00
<LineBreak/>
• Distance 3 → 0.67
<LineBreak/>
• Distance 4 → 0.50
<LineBreak/><LineBreak/>

<Bold>Humidity effect:</Bold>
humidityEffect = 1 − airHumidity
<LineBreak/>
• 0% → 1.00
<LineBreak/>
• 50% → 0.50
<LineBreak/>
• 80% → 0.20
<LineBreak/><LineBreak/>

<Bold>Temperature effect:</Bold>
Calculated from air temperature:
<LineBreak/>
• Cold air → factor &lt; 1
<LineBreak/>
• Hot air → factor &gt; 1
<LineBreak/><LineBreak/>

<Bold>Wind effect:</Bold>
Based on wind strength and alignment:
<LineBreak/>
• Wind aligned with target → factor &gt; 1
<LineBreak/>
• Wind against target → factor &lt; 1
<LineBreak/><LineBreak/>

<Bold>Note:</Bold>
This setting does not affect direct neighbor fire spread.
It only adds long-range spot fires.
		</TextBlock>

		<!-- Environment -->
		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="AirHumidityTooltip">
<Bold>Air Humidity:</Bold> Ambient moisture level in % (0–100%).
<LineBreak/><LineBreak/>
<Bold>Effect on Fire:</Bold>
- High humidity → easier fire spread
- Low humidity → easier fire spread
<LineBreak/><LineBreak/>
<Bold>Distribution:</Bold> Instant effect applied uniformly across the simulation grid.
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="AirTemperatureTooltip">
<Bold>Air Temperature:</Bold> Ambient temperature in °C (-10 ⇒ 50).
<LineBreak/><LineBreak/>
<Bold>Effect on Fire:</Bold>
- Higher temperature → increased fire spread chance
- Lower temperature → decreased fire spread chance
<LineBreak/><LineBreak/>
<Bold>Notes:</Bold> Works in combination with humidity to determine local fire dynamics.
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="350" x:Key="RandomWindDirectionTooltip">
<Bold>Random Wind Direction:</Bold> If enabled, wind direction fluctuates slightly each update.
<LineBreak/><LineBreak/>
<Bold>Details:</Bold>
• Maximum fluctuation: ±5° per simulation tick
<LineBreak/>• Updates every simulation tick (interval = SimulationSpeed + 300 ms)
<LineBreak/>• Fluctuations are uniformly distributed (all angles equally likely within ±5°)
<LineBreak/><LineBreak/>
<Bold>Effect:</Bold> Fire spreads faster when aligned with wind, slower against it; dynamic fire fronts.
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="WindDirectionFromTooltip">
<Bold>Wind Direction:</Bold> The base direction from which the wind blows.
<LineBreak/><LineBreak/>
<Bold>Options:</Bold> Usually represented as compass points (e.g., N, NE, E, SE, S, SW, W, NW).
<LineBreak/>- 0° = North, 90° = East, 180° = South, 270° = West
<LineBreak/><LineBreak/>
<Bold>Effect:</Bold> Fire spreads faster in the direction the wind blows, slower against it.
<LineBreak/><LineBreak/>
<Bold>Random Wind:</Bold> If "Random wind direction" is enabled, this value is the starting direction, and it fluctuates ±5° per simulation tick.
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="300" x:Key="WindDirectionBoxTooltip">
<Bold>Select Wind Direction:</Bold> Choose the compass direction from which the wind blows.
<LineBreak/>- Changes affect fire spread alignment immediately.
<LineBreak/>- Works together with "Random wind direction" for dynamic wind behavior.
		</TextBlock>

		<TextBlock TextWrapping="Wrap" MaxWidth="350" x:Key="WindStrengthTooltip">
			<Bold>Wind Strength:</Bold> Affects fire spread in the current wind direction.
			<LineBreak/><LineBreak/>

			<Bold>Beaufort Scale (Bft):</Bold> Standardized system to estimate wind force:
			<LineBreak/>
			0 → Calm (less than 1 km/h)
			<LineBreak/>
			1 → Light Air (1–5 km/h)
			<LineBreak/>
			2 → Light Breeze (6–11 km/h)
			<LineBreak/>
			3 → Gentle Breeze (12–19 km/h)
			<LineBreak/>
			4 → Moderate Breeze (20–28 km/h)
			<LineBreak/>
			5 → Fresh Breeze (29–38 km/h)
			<LineBreak/>
			6 → Strong Breeze (39–49 km/h)
			<LineBreak/>
			7 → Strong Wind (50–61 km/h)
			<LineBreak/>
			8 → Severe Wind (62–74 km/h)
			<LineBreak/>
			9 → Storm (75–88 km/h)
			<LineBreak/>
			10 → Violent Storm (89–102 km/h)
			<LineBreak/>
			11 → Hurricane (103–117 km/h)
			<LineBreak/>
			12 → Hurricane Extreme (more than 118 km/h)
			<LineBreak/><LineBreak/>

			<Bold>Random Wind Strength Enabled:</Bold>
			<LineBreak/>
			• Start value set by the slider (0%–100%)
			<LineBreak/>
			• Wind strength randomly fluctuates ±3% per update
			<LineBreak/>
			• Wind direction randomly fluctuates ±5° per update
			<LineBreak/>
			• Updates occur every simulation tick, interval = (SimulationSpeed + 300 ms)
			<LineBreak/>
			• Fluctuations are uniformly distributed (all values equally likely within the range)
			<LineBreak/><LineBreak/>

			<Bold>Effect:</Bold> Enabling random wind creates dynamic fire behavior:
			fire spreads faster when aligned with wind, slower against wind.
		</TextBlock>
	</Window.Resources>

	<Grid Margin="20">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Simulate-Button -->
		<Button Grid.Row="0" Height="40" Width="120" HorizontalAlignment="Right" VerticalAlignment="Top" Click="StartSimulation_Click" Style="{StaticResource CustomButtonStyle}">
			<Button.ToolTip>Starts the simulation in a new window</Button.ToolTip>
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Play" Width="10" Height="10"/>
					<TextBlock Text="Simulate" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Reset-Button -->
		<Button Grid.Row="0"
			Height="40" Width="120"
			HorizontalAlignment="Center" VerticalAlignment="Top"
			Click="ResetAllSettings_Click"
			ToolTip="Set page settings back to default (R)"
			Style="{StaticResource CustomButtonStyle}">
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Undo" Width="10" Height="10"/>
					<TextBlock Text="Reset config" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Graphics Settings Button -->
		<Button Grid.Row="0" Height="40" Width="120"
			HorizontalAlignment="Left" VerticalAlignment="Top"
			Click="OpenGraphicsSettingsWindow"
			Style="{StaticResource CustomButtonStyle}"
			ToolTip="Open graphics settings window">
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Cog" Width="10" Height="10"/>
					<TextBlock Text="Graphic config" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Settingboxes -->
		<StackPanel Grid.Row="1" VerticalAlignment="Top">

			<!-- Terrain -->
			<GroupBox Header="Terrain" Style="{StaticResource CustomGroupBoxStyle}" Margin="0,8,0,0">
				<CheckBox x:Name="TerrainGenerationCheckBox"
					Content="Enable terrain generation" IsChecked="True"
					ToolTip="{StaticResource TerrainGenerationTooltip}"/>
			</GroupBox>

			<!-- Trees -->
			<GroupBox Header="Trees" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Green">
				<StackPanel>
					<CheckBox Margin="5,0,0,0" x:Name="GrowForestCheckBox" Content="Grow forest"
						IsChecked="True"
						Checked="GrowForestCheckBox_Changed"
						Unchecked="GrowForestCheckBox_Changed"
						ToolTip="{StaticResource GrowForestTooltip}"/>

					<!-- TextBlock für Prefill density Wert -->
					<TextBlock Margin="10,5,0,0" FontSize="14"
						Text="{Binding ElementName=PrefillDensitySlider, Path=Value, StringFormat=Prefill density: {0:F0}%}"
						ToolTip="{StaticResource PrefillTooltip}"/>
					<Slider x:Name="PrefillDensitySlider" Minimum="0" Maximum="100"
						Value="80" TickFrequency="5" IsSnapToTickEnabled="True"/>
				</StackPanel>
			</GroupBox>

			<!-- Fire -->
			<GroupBox Header="Fire" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Red">
				<StackPanel>
					<CheckBox Margin="5,0,60,0" x:Name="PauseFireCheckBox"
						Content="Pause growing during fire" IsChecked="True"
						ToolTip="{StaticResource PauseFireTooltip}"/>
					<TextBlock Text="{Binding ElementName=FireSpreadChanceSlider, Path=Value, StringFormat=Additional fire spread chance: {0:F0}%}"
						FontSize="14" Margin="10,5,0,0"
						ToolTip="{StaticResource FireSpreadChanceTooltip}"/>
					<Slider x:Name="FireSpreadChanceSlider" Maximum="100" Value="40" IsSnapToTickEnabled="True" TickFrequency="5"/>
				</StackPanel>
			</GroupBox>

			<!-- Environment -->
			<GroupBox Header="Environment" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Blue">
				<StackPanel>
					<!-- Air Humidity -->
					<TextBlock Margin="10,0,0,0" FontSize="14" Text="{Binding ElementName=AirHumiditySlider, Path=Value, StringFormat=Air humidity: {0:F0}%}"
						ToolTip="{StaticResource AirHumidityTooltip}"/>

					<Slider x:Name="AirHumiditySlider" Minimum="0" Maximum="100" Value="50" TickFrequency="5" IsSnapToTickEnabled="True"/>
					<!-- Air Temperature -->
					<TextBlock Margin="10,5,0,0" FontSize="14" Text="{Binding ElementName=AirTemperatureSlider, Path=Value, StringFormat=Air temperature: {0:F0} °C}"
						ToolTip="{StaticResource AirTemperatureTooltip}"/>

					<Slider x:Name="AirTemperatureSlider" Minimum="-10" Maximum="50" Value="30" TickFrequency="1" IsSnapToTickEnabled="True"/>
					<!-- Random Wind Direction -->
					<CheckBox Margin="5,5,0,0" x:Name="RandomWindDirectionCheckBox"
						Content="Random wind direction" IsChecked="False"
						Checked="RandomWindDirectionCheckBox_Changed"
						Unchecked="RandomWindDirectionCheckBox_Changed"
						ToolTip="{StaticResource RandomWindDirectionTooltip}"/>

					<TextBlock Margin="10,5,0,0" Text="Wind direction (from)"
						ToolTip="{StaticResource WindDirectionFromTooltip}"/>

					<ComboBox Margin="4,5,4,0" x:Name="WindDirectionBox"
						SelectedIndex="0" MinWidth="150"
						ToolTip="{StaticResource WindDirectionBoxTooltip}"/>

					<!-- Random Wind Strength -->
					<CheckBox Margin="5,5,0,0" x:Name="RandomWindStrengthCheckBox"
						Content="Random wind strength" IsChecked="False"
						ToolTip="{StaticResource WindStrengthTooltip}"/>
					<TextBlock x:Name="WindStrengthText" Margin="10,5,0,0" FontSize="14"
						Text="Wind Strength: 0% (0 Bft)"
						ToolTip="{StaticResource WindStrengthTooltip}"/>
					<Slider x:Name="WindStrengthSlider" Minimum="0" Maximum="1" Value="0.75"
						TickFrequency="0.05" IsSnapToTickEnabled="True"
						ValueChanged="WindStrengthSlider_ValueChanged"/>
				</StackPanel>
			</GroupBox>
		</StackPanel>
	</Grid>

</Window>
