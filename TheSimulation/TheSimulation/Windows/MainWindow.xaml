<Window x:Class="TheSimulation.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:local="clr-namespace:TheSimulation"
        mc:Ignorable="d"
        Title="Forest fire simulation configuration"
        Height="700"
        Width="1000"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen" KeyDown="Window_KeyDown">

	<Window.Resources>
		<!-- Style für GroupBoxen -->
		<Style x:Key="CustomGroupBoxStyle" TargetType="GroupBox">
			<Setter Property="BorderBrush" Value="#FF4C8F94"/>
			<Setter Property="BorderThickness" Value="2"/>
			<Setter Property="Padding" Value="10"/>
			<Setter Property="Background" Value="WhiteSmoke"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect Color="Black" Direction="315" ShadowDepth="5" Opacity="0.2" BlurRadius="8"/>
				</Setter.Value>
			</Setter>
		</Style>

		<!-- Style für Buttons -->
		<Style x:Key="CustomButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="#FF4C8F94"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="Width" Value="120"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect Color="Black" Direction="315" ShadowDepth="5" Opacity="0.3" BlurRadius="8"/>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>

	<Grid Margin="20">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Simulate-Button -->
		<Button Grid.Row="0" Height="40" Width="120" HorizontalAlignment="Right" VerticalAlignment="Top" Click="StartSimulation_Click" Style="{StaticResource CustomButtonStyle}">
			<Button.ToolTip>Starts the simulation in a new window</Button.ToolTip>
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Play" Width="10" Height="10"/>
					<TextBlock Text="Simulate" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Reset-Button -->
		<Button Grid.Row="0"
		Height="40" Width="120"
		HorizontalAlignment="Center" VerticalAlignment="Top"
		Click="ResetAllSettings_Click"
		ToolTip="Set page settings back to default (R)"
		Style="{StaticResource CustomButtonStyle}">
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Undo" Width="10" Height="10"/>
					<TextBlock Text="Reset config" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Graphics Settings Button -->
		<Button Grid.Row="0" Height="40" Width="120" HorizontalAlignment="Left" VerticalAlignment="Top" Click="OpenGraphicsSettingsWindow" Style="{StaticResource CustomButtonStyle}">
			<Button.ToolTip>Open graphics settings window</Button.ToolTip>
			<Button.Content>
				<StackPanel Orientation="Horizontal">
					<fa:ImageAwesome Icon="Cog" Width="10" Height="10"/>
					<TextBlock Text="Graphic config" Margin="5,0,0,0"/>
				</StackPanel>
			</Button.Content>
		</Button>

		<!-- Settingboxes -->
		<StackPanel Grid.Row="1" VerticalAlignment="Top">

			<!-- Terrain -->
			<GroupBox Header="Terrain" Style="{StaticResource CustomGroupBoxStyle}" Margin="0,8,0,0">
				<StackPanel>
					<CheckBox x:Name="TerrainGenerationCheckBox" Content="Enable terrain generation" IsChecked="True">
						<CheckBox.ToolTip>
							<TextBlock TextWrapping="Wrap" MaxWidth="300">
<Bold>Terrain Generation:</Bold> Generates the terrain using a height map with a central hill and slight random noise. Elevation ranges from 0 (lowest) to 1 (highest).  
<LineBreak/><LineBreak/>

<Bold>Tree Placement:</Bold>
Trees are placed on randomly selected cells using a <Bold>uniform distribution</Bold> across all growable cells.  
<LineBreak/>
- Each selected cell has a growth probability reduced linearly by elevation:  
<LineBreak/>
  P(grow) = 1 - (Elevation × 0.7)  
<LineBreak/>
- Small random noise ±0.1 is added to elevation (uniform), changing growth chance by ±7%.  
<LineBreak/>
- Example probabilities:  
<LineBreak/>
  • Elevation 0.0 → 100%  
<LineBreak/>
  • Elevation 0.3 → 79%  
<LineBreak/>
  • Elevation 0.5 → 65%  
<LineBreak/>
  • Elevation 0.7 → 51%  
<LineBreak/>
  • Elevation 1.0 → 30%  
<LineBreak/><LineBreak/>

<Bold>Fire Spread on Slopes:</Bold>
Fire spreads faster uphill and slower downhill. Effect is calculated from height difference (Δheight):  
<LineBreak/>
• Uphill (Δheight &gt; 0): factor = 1 + Δheight × 2  
<LineBreak/>
• Downhill (Δheight &lt; 0): factor = 1 + Δheight  
<LineBreak/><LineBreak/>

<Bold>Example:</Bold>
• From 0.3 → 0.5 (Δheight = 0.2): factor = 1.4 → fire spreads 40% faster  
<LineBreak/>
• From 0.5 → 0.3 (Δheight = -0.2): factor = 0.8 → fire spreads 20% slower  
<LineBreak/><LineBreak/>

<Bold>Effect:</Bold> Enabling terrain generation creates a natural hill-shaped forest with variable tree density, adding realistic randomness and dynamic fire behavior.
							</TextBlock>
						</CheckBox.ToolTip>
					</CheckBox>
				</StackPanel>
			</GroupBox>

			<!-- Trees -->
			<GroupBox Header="Trees" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Green">
				<StackPanel>
					<CheckBox Margin="5,0,0,5" x:Name="GrowForestCheckBox" Content="Grow forest"
          IsChecked="True"
          Checked="GrowForestCheckBox_Changed"
          Unchecked="GrowForestCheckBox_Changed">
						<CheckBox.ToolTip>
							<TextBlock TextWrapping="Wrap" MaxWidth="300">
            When enabled, trees will grow over time to replenish the forest.
            <LineBreak/>
            <LineBreak/>
            <Bold>Next tree timing:</Bold> Trees grow in steps determined by the simulation clock. 
            Each tick triggers an attempt to grow a single tree.
            <LineBreak/>
            <LineBreak/>
            <Bold>Next tree location:</Bold> A cell is chosen randomly from all currently growable cells (those without trees or obstacles). 
            If terrain generation is enabled, the growth probability is reduced on higher elevations: 
            taller hills are less likely to receive a new tree, while valleys are more likely.
            <LineBreak/>
            <LineBreak/>
            <Bold>Distribution pattern:</Bold> 
            - Horizontally: uniform random selection across all free cells. 
            - Vertically (height): linear decreasing probability from valleys (high chance) to hills (low chance). 
            - Result: more trees appear in low areas, fewer on elevated terrain, creating a natural, uneven forest density.
							</TextBlock>
						</CheckBox.ToolTip>
					</CheckBox>

					<CheckBox Margin="5,5,0,0" x:Name="PrefillCheckBox" Content="Prefill forest"
					  IsChecked="True"
					  Checked="PrefillCheckBox_Changed"
					  Unchecked="PrefillCheckBox_Changed"/>
					<!-- TextBlock für Prefill density Wert -->
					<TextBlock Margin="10,5,0,5" FontSize="14" Text="{Binding ElementName=PrefillDensitySlider, Path=Value, StringFormat=Prefill density: {0:F0}%}"/>
					<Slider x:Name="PrefillDensitySlider" Minimum="0" Maximum="100" Value="80" TickFrequency="5" IsSnapToTickEnabled="True"/>
				</StackPanel>
			</GroupBox>

			<!-- Fire -->
			<GroupBox Header="Fire" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Red">
				<StackPanel>
					<CheckBox Margin="5,0,60,0" x:Name="PauseFireCheckBox" Content="Pause growing during fire" IsChecked="True"/>
					<TextBlock Text="{Binding ElementName=FireSpreadChanceSlider, Path=Value, StringFormat=Additional fire spread chance: {0:F0}%}" FontSize="14" Margin="10,5,0,0"/>
					<Slider x:Name="FireSpreadChanceSlider" Maximum="100" Value="40" IsSnapToTickEnabled="True" TickFrequency="5"/>
				</StackPanel>
			</GroupBox>

			<!-- Environment -->
			<GroupBox Header="Environment" Margin="0,8,0,0" Style="{StaticResource CustomGroupBoxStyle}" BorderBrush="Blue">
				<StackPanel>
					<!-- Air Humidity -->
					<TextBlock Margin="10,0,0,0" FontSize="14" Text="{Binding ElementName=AirHumiditySlider, Path=Value, StringFormat=Air humidity: {0:F0}%}"/>
					<Slider x:Name="AirHumiditySlider" Minimum="0" Maximum="100" Value="50" TickFrequency="5" IsSnapToTickEnabled="True"/>
					<!-- Air Temperature -->
					<TextBlock Margin="10,5,0,0" FontSize="14" Text="{Binding ElementName=AirTemperatureSlider, Path=Value, StringFormat=Air temperature: {0:F0} °C}"/>
					<Slider x:Name="AirTemperatureSlider" Minimum="-10" Maximum="50" Value="30" TickFrequency="1" IsSnapToTickEnabled="True"/>
					<!-- Random Wind Direction -->
					<CheckBox Margin="5,5,0,0" x:Name="RandomWindDirectionCheckBox" Content="Random wind direction" IsChecked="False" Checked="RandomWindDirectionCheckBox_Changed" Unchecked="RandomWindDirectionCheckBox_Changed"/>
					<TextBlock Margin="10,5,0,0" Text="Wind direction (from)"/>
					<ComboBox Margin="4,5,4,0" x:Name="WindDirectionBox" SelectedIndex="0" MinWidth="150"/>
					<!-- Random Wind Strength -->
					<CheckBox Margin="5,5,0,0" x:Name="RandomWindStrengthCheckBox" Content="Random wind strength" IsChecked="False"/>
					<TextBlock x:Name="WindStrengthText" Margin="10,5,0,0" FontSize="14" Text="Wind Strengh: 0% (0 Bft)">
						<TextBlock.ToolTip>
							<TextBlock>
								Wind strength affects fire spread in the given direction.
								<LineBreak/>
								Bft stands for Beaufort Scale and is a standardized system to
								estimate wind force.
								<LineBreak/>
								Each level corresponds to a range of wind
								speeds and descriptive terms:
								<LineBreak/>
								0 → Calm below 1 km/h
								<LineBreak/>
								1 → Light Air (1–5 km/h)
								<LineBreak/>
								2 → Light Breeze (6–11 km/h)
								<LineBreak/>
								3 → Gentle Breeze (12–19 km/h)
								<LineBreak/>
								4 → Moderate Breeze (20–28 km/h)
								<LineBreak/>
								5 → Fresh Breeze (29–38 km/h)
								<LineBreak/>
								6 → Strong Breeze (39–49 km/h)
								<LineBreak/>
								7 → Strong Wind (50–61 km/h)
								<LineBreak/>
								8 → Severe Wind (62–74 km/h)
								<LineBreak/>
								9 → Storm (75–88 km/h)
								<LineBreak/>
								10 → Violent Storm (89–102 km/h)
								<LineBreak/>
								11 → Hurricane (103–117 km/h)
								<LineBreak/>
								12 → Hurricane Extreme (118+ km/h)"
							</TextBlock>
						</TextBlock.ToolTip>
					</TextBlock>
					<Slider x:Name="WindStrengthSlider" Minimum="0" Maximum="1" Value="0.75" TickFrequency="0.05" IsSnapToTickEnabled="True" ValueChanged="WindStrengthSlider_ValueChanged"/>
				</StackPanel>
			</GroupBox>
		</StackPanel>
	</Grid>

</Window>
